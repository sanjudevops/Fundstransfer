var CreatePage=Vue.component("create-page",{template:"#create-page-template",data:()=>({tables:[],queries:[],pages:[],content:{key:"",value:"Add content"},selectedPage:"",selectedTable:"",selectedQuery:"",page:{_id:"",title:"",href:"",link:"",content:{},tables:{},queries:{}}}),watch:{selectedPage(){this.selectedPage?this.page=this.pages[this.selectedPage]:this.page={_id:"",title:"",href:"",link:"",content:{},tables:{},queries:{}},$("#editor").summernote("code","Add content...")}},methods:{addTableBinding(e){this.page.tables||this.$set(this.page,"tables",{}),this.$set(this.page.tables,e,"")},dropTableBinding(e){this.$delete(this.page.tables,e)},addQueryBinding(e){this.page.queries||this.$set(this.page,"queries",{}),this.$set(this.page.queries,e,"")},dropQueryBinding(e){this.$delete(this.page.queries,e)},addContent(e){console.log("adding content -> "+e.key);let t=$("#editor").summernote("code");this.page.content||this.$set(this.page,"content",{}),this.$set(this.page.content,e.key,t)},dropContent(e){console.log("dropping content -> "+e),this.$delete(this.page.content,e)},selectContent(e){console.log("selected content -> "+e),this.content={key:e,value:this.page.content[e]},$("#editor").summernote("code",this.page.content[e])}},mounted(){$("#editor").summernote({focus:!0}).summernote("code","Add content...");let e=this;$("#save").on("click",function(t){console.log(JSON.stringify(e.page)),$.ajax({url:"/admin/pages/"+e.page._id,type:"post",contentType:"application/json",data:JSON.stringify(e.page),success:function(t){console.log(t),e.page=t.page,eventHub.$emit("alert",{type:"success",message:"Page saved successfully",close:2e3})},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})}),$.ajax({url:"/admin/dynamic",type:"get",dataType:"json",success:function(t){console.log(t),e.pages=t.dyna.pages,e.tables=t.dyna.tables,e.queries=t.dyna.queries},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})}}),CreateTable=Vue.component("create-table",{template:"#create-table-template",data:()=>({table:"",tables:[],columns:[],selectedTable:"",selectedColumn:""}),computed:{column(){return""!==this.selectedColumn?this.columns[this.selectedColumn]:{name:"",type:"text",notnull:!1,primary:!1,autoinc:!1,unique:!1,editable:!1,visible:!0,disabled:!1,defvalue:"",label:"",format:"",length:"",regex:""}}},methods:{addColumn(){let e=jQuery.extend(!0,{},this.column);e.name="column"+this.columns.length,this.columns.push(e)},selectColumn(e){console.log("selectedColumn -> "+e),this.selectedColumn=e},dropColumn(){this.columns.splice(this.selectedColumn,1),this.selectedColumn>0?this.selectedColumn--:this.selectedColumn+1<this.columns.length?this.selectedColumn++:this.selectedColumn=""},selectTable(e){if(""!==e){let t=this;console.log("selected table => "+e),this.selectedTable=e,$.ajax({url:"/admin/table/"+this.selectedTable+"/meta",type:"GET",contentType:"application/json",success:function(e){console.log(e),eventHub.$emit("alert",{type:"success",message:"retrieved table metadata"});var s=Object.keys(e.table.columns).reduce((t,s)=>{let a=e.table.columns[s];return a.name=s,t.push(a),t},[]);t.columns=s},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})}else this.columns=[],this.selectedColumn=""},createTable(){let e=this;console.log(this.columns),$.ajax({url:"/admin/table/"+this.table,type:"POST",data:JSON.stringify(this.columns),contentType:"application/json",success:function(t){console.log(t),e.tables=Object.keys(t.tables),eventHub.$emit("alert",{type:"success",message:"new db table created"})},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})},updateTable(){let e=this;console.log(this.columns),$.ajax({url:"/admin/table/"+this.selectedTable+"/sync",type:"POST",data:JSON.stringify(this.columns.reduce((e,t)=>(e[t.name]=t,e),{})),contentType:"application/json",success:function(t){console.log(t),e.tables=Object.keys(t.tables),eventHub.$emit("alert",{type:"success",message:"table metadata updated"})},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})}},mounted(){let e=this;$.ajax({url:"/admin/dbviews",type:"get",dataType:"json",success:function(t){console.log(t),e.tables=t.tables},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})}}),SyncTables=Vue.component("sync-tables",{template:"#sync-tables-template",data:()=>({dbTables:[],dbSelected:"",dbColumns:{},dynTables:[],dynSelected:"",dynColumns:{}}),computed:{},methods:{idCollapse:(e,t)=>"collapse_"+e+t,hrefCollapse:(e,t)=>"#collapse_"+e+t,headingIndex:(e,t)=>"heading_"+e+t,onDbSelected(){let e=this;this.dbSelected?(console.log("db selected -> "+this.dbSelected),$.ajax({url:"/admin/table/"+this.dbSelected+"/columns",type:"get",dataType:"json",success:function(t){console.log(t),e.dbColumns=t.columns,eventHub.$emit("alert",{type:"success",message:"database metadata fetched successfully",close:2e3})},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})):e.dbColumns={}},onDynSelected(){let e=this;this.dynSelected?(console.log("dyn selected -> "+this.dynSelected),$.ajax({url:"/admin/table/"+this.dynSelected+"/meta",type:"get",dataType:"json",success:function(t){console.log(t),e.dynColumns=t.table.columns,eventHub.$emit("alert",{type:"success",message:"dynamic metadata fetched successfully",close:2e3})},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})):e.dynColumns={}},syncTable(){let e=this;console.log("syncing table -> "+this.dbSelected),$.ajax({url:"/admin/table/"+this.dbSelected+"/sync",type:"post",contentType:"application/json",dataType:"json",data:JSON.stringify(e.dbColumns),success:function(t){console.log(t),e.dynTables=t.tables,eventHub.$emit("alert",{type:"success",message:"database metadata added to/updated in dynamic metadata",close:2e3})},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})}},mounted(){let e=this;$.ajax({url:"/admin/dbviews",type:"get",dataType:"json",success:function(t){console.log(t),e.dbTables=t.tables},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}}),$.ajax({url:"/admin/dynamic",type:"get",dataType:"json",success:function(t){console.log(t),e.dynTables=t.dyna.tables},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})}}),TableView=Vue.component("table-data-view",{template:"#table-data-view",data:()=>({user:{},data:[],table:"",tables:[],selectedRow:{},selectedTable:"",start:0,limit:20,count:"",dataColumns:{}}),computed:{columns(){return this.dataColumns?Object.keys(this.dataColumns):[]},values(){return this.data}},methods:{loadValues(e){let t=this;this.selectedRow={},this.table=e,$.ajax({url:"/admin/dbviews/table/"+e+"?start="+t.start+"&size="+t.limit,type:"get",dataType:"json",success:function(e){console.log(e),t.user=e.user,t.count=e.count,t.data=e.data,t.dataColumns=e.columns,eventHub.$emit("alert",{type:"success",message:"loaded requested table values"})},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})},loadPrev(){this.start=this.start-this.limit,this.loadValues(this.selectedTable)},loadNext(){this.start=this.start+this.limit,this.loadValues(this.selectedTable)},selectTable(e){console.log("selected table --\x3e "+e),this.selectedTable=e},selectRow(e){console.log("selected row --\x3e "+e),this.selectedRow=e},updateDbRow(e){let t=this,s=$(e.target);$.ajax({url:"/admin/dbviews/table/"+t.table,type:"PUT",dataType:"json",data:s.serialize(),success:function(e){console.log(e),t.user=e.user,eventHub.$emit("alert",{type:"success",message:"operation successful"})},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})},inputType(e){switch(e){case"date":return"date";case"blob":return"file";case"int":case"numeric":return"number";default:return"text"}}},mounted(){let e=this;$.ajax({url:"/admin/dbviews",type:"get",dataType:"json",success:function(t){console.log(t),e.user=t.user,e.tables=t.tables},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})}}),InsertRecord=Vue.component("insert-record",{template:"#insert-record-template",data:()=>({tables:{},columns:{},record:{},selected:""}),watch:{selected:function(e){console.log("selected "+e);let t=this;$.ajax({url:"/admin/table/"+e+"/meta",type:"get",dataType:"json",success:function(e){console.log(e),t.columns=e.table.columns,t.record=Object.keys(e.table.columns).reduce(function(e,t){return e[t]="",e},{}),eventHub.$emit("alert",{type:"success",message:"dyna table columns retrieved"})},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})}},methods:{onInsert(e){var t=$(e.target);console.log(t.serialize());let s=this;$.ajax({url:"/admin/dbviews/table/"+s.selected,type:"post",data:t.serialize(),dataType:"json",success:function(e){console.log(e),eventHub.$emit("alert",{type:"success",message:"operation successful"})},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})},inputType(e){switch(e){case"date":return"date";case"blob":return"file";case"int":case"numeric":return"number";default:return"text"}}},mounted(){let e=this;$.ajax({url:"/admin/table/names",type:"get",dataType:"json",success:function(t){console.log(t),e.tables=t.tables}})}}),UpdateRecord=Vue.component("update-record",{template:"#update-record-template",data:()=>({tables:{},columns:{},records:[],index:0,criteria:{start:0,limit:10},selected:""}),computed:{record(){return this.records.length>0?this.records[this.index]:Object.keys(this.columns).reduce(function(e,t){return e[t]="",e},{})}},watch:{selected:function(e){console.log("selected "+e);let t=this;$.ajax({url:"/admin/table/"+e+"/meta",type:"get",dataType:"json",success:function(e){console.log(e),t.columns=e.table.columns,t.criteria=Object.keys(e.table.columns).reduce(function(e,t){return e[t]="",e},{start:0,limit:10}),eventHub.$emit("alert",{type:"success",message:"dyna table columns retrieved"})},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}}),this.records=[]}},methods:{searchTable(){let e=this;$.ajax({url:"/admin/table/"+e.selected+"/query",type:"post",data:JSON.stringify(Object.keys(e.criteria).reduce(function(t,s){return e.criteria[s]&&(t[s]=e.criteria[s]),t},{})),contentType:"application/json",success:function(t){console.log(t),e.records=t.data,eventHub.$emit("alert",{type:"success",message:"search returned "+t.data.length+" records"})},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})},updateRecord(){let e=this;$.ajax({url:"/admin/table/"+e.selected,type:"put",data:JSON.stringify(e.record),contentType:"application/json",success:function(e){console.log(e),eventHub.$emit("alert",{type:"success",message:"record u[dated successful"})},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})},nextIndex(){this.index<this.records.length-1&&this.index++},prevIndex(){this.index>0&&this.index--},inputType(e){switch(e){case"date":return"date";case"blob":return"file";case"int":case"numeric":return"number";default:return"text"}}},mounted(){let e=this;$.ajax({url:"/admin/dbviews",type:"get",dataType:"json",success:function(t){console.log(t),e.tables=t.tables}})}}),QueryView=Vue.component("query-data-view",{template:"#query-data-view",data:()=>({queries:[],query:{_id:"",squel:"",params:[]},currParam:"",selected:"",execute:!1,criteria:{},data:[]}),computed:{columns(){return this.data.length>0?Object.keys(this.data[0]):[]},values(){return this.data}},methods:{selectQuery(e){this.selected=e,this.execute=!1,this.criteria={},this.data=[],this.query=Object.keys(this.queries).length>0?this.queries[e]:{}},removeQuery(e){let t=this;console.log("removing -> "+e),$.ajax({url:"/admin/query/"+t.selected,type:"delete",dataType:"json",success:function(e){console.log(e),t.queries=e.queries,eventHub.$emit("alert",{type:"success",message:"operation successful"})},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})},addParam(){this.query.params.push(this.currParam)},dropParam(e,t){console.log("remove '"+e+"' param at index "+t),this.query.params.splice(t,1)},createQuery(){let e=this;console.log(JSON.stringify(this.query)),$.ajax({url:"/admin/query/"+this.query._id,type:"put",data:JSON.stringify(this.query),contentType:"application/json",dataType:"json",success:function(t){console.log(t),e.queries=t.queries,eventHub.$emit("alert",{type:"success",message:"created query successfully",close:2e3})},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})},resetQueryForm(){this.query={_id:"",squel:"",params:[]},this.selected="",this.execute=!1,this.criteria={},this.data=[]},prepareCriteria(){this.execute?(this.criteria=this.query.params.reduce(function(e,t){return e[t]="",e},this.criteria),console.log(this.criteria)):this.criteria={}},executeQuery(){let e=this;console.log(JSON.stringify(this.criteria)),$.ajax({url:"/admin/query/"+this.query._id,type:"post",data:JSON.stringify(this.criteria),contentType:"application/json",dataType:"json",success:function(t){console.log(t),e.data=t.data,eventHub.$emit("alert",{type:"success",message:"query executed successfully",close:2e3})},error:function(e){eventHub.$emit("alert",{type:"warning",message:e.responseText})}})}},mounted(){let e=this;$.ajax({url:"/admin/query",type:"get",dataType:"json",success:function(t){console.log(t),e.queries=t.queries}})}}),AlertFeedback=Vue.component("alert-feedback",{template:"#alert-feedback",data:()=>({alert:{message:"",type:"warning"}}),computed:{alertType(){switch(this.alert.type){case"warning":return"alert-warning";case"success":return"alert-success";default:return"alert-info"}}},methods:{closeAlert(){this.alert.message=""}},mounted(){let e=this;eventHub.$on("alert",function(t){e.alert=t,t.close&&setTimeout(function(){e.alert.message=""},t.close)})}});const eventHub=new Vue;var DynamicEditor=Vue.component("dynamic-editor",{template:"#dyna-content-editor"}),app=new Vue({el:"#app"});